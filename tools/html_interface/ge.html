<html>
    <head>
        <title>UAV Visualization</title>
        <link rel="stylesheet" type="text/css" href="fi/css/flightindicators.css" />
        <script type="text/javascript" src="https://www.google.com/jsapi"> </script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="fi/js/jquery.flightindicators.min.js"></script>
        
    </head>
    <body>
        <div id='fi' style="position:absolute; z-index: 50; width: 200px" >
            <span id="attitude"></span>
            <span id="heading"></span>
        </div>
        <div id="map3d" style="left: 205px; height: 900px; width: 1400px; position: absolute; z-index: 25;"></div>
    </body>
    <script type="text/javascript">
        var ge;
        google.load("earth", "1", {"other_params":"sensor=true_or_false"});

        function init() {
        google.earth.createInstance('map3d', initCB, failureCB);
        }

        function initCB(instance) {
            ge = instance;
            ge.getWindow().setVisibility(true);
            
            ge.getNavigationControl().setVisibility(ge.VISIBILITY_SHOW);
            ge.getOptions().setStatusBarVisibility(true);
            ge.getOptions().setScaleLegendVisibility(true);
            ge.getTime().getControl().setVisibility(ge.VISIBILITY_SHOW);
            
            ge.getSun().setVisibility(true);
            ge.getOptions().setAtmosphereVisibility(true);
            
            ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS , true);
            ge.getLayerRoot().enableLayerById(ge.LAYER_BUILDINGS, true);
            ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS , false);
            ge.getLayerRoot().enableLayerById(ge.LAYER_TERRAIN , true);
            ge.getLayerRoot().enableLayerById(ge.LAYER_TREES , true);
            
            updateView(ge,36.584207, -121.754322, 1000.0);
            init_fi();
            

            
        }

        function failureCB(errorCode) {
        }

        google.setOnLoadCallback(init);
        
        function updateView(google_instance, lat, lon, hig) {
            // Create a new LookAt.
            var lookAt = google_instance.createLookAt('');

            // Set the position values.
            lookAt.setLatitude(lat);
            lookAt.setLongitude(lon);
            lookAt.setRange(hig); //default is 0.0
            lookAt.setTilt(0);
            // Update the view in Google Earth.
            google_instance.getView().setAbstractView(lookAt);
        }
        
        function init_fi(){
            var ajax_port = 43017;
            var options = {
                size : 200,             // Sets the size in pixels of the indicator (square)
                showBox : true,         // Sets if the outer squared box is visible or not (true or false)
                img_directory : 'fi/img/'  // The directory where the images are saved to
            }
            //Initializing FI 
            var attitude = $.flightIndicator('#attitude', 'attitude', options);
            var heading = $.flightIndicator('#heading', 'heading', options);
            //Setting FI updates
            setInterval(function() {
                $.ajax({
                    url : 'http://127.0.0.1:'+ ajax_port, 
                    type : 'POST', 
                    data : { topic: "ATTITUDE"},
                    dataType : 'json',
                    success : function(data, status){
                        attitude.setRoll(-data['roll']/Math.PI*180);
                        attitude.setPitch(data['pitch']/Math.PI*180);
                        heading.setHeading(data['yaw']/Math.PI*180);
                    }
                });
            }, 50);
        }

    </script>
</html>